-- ensure employee 115 exists
INSERT INTO Employee(emp_id, first_name, last_name, job_title, dept_id, salary, DoJ) VALUES (115,'Kamal','Roy','Tester',30,45000, DATE '2008-07-01');
COMMIT;

-- Salary_Increment table
DROP TABLE Salary_Increment PURGE;
CREATE TABLE Salary_Increment (
  rec_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  emp_id NUMBER,
  new_salary NUMBER(12,2),
  changed_on DATE DEFAULT SYSDATE
);

-- anonymous block
DECLARE
  v_emp Employee%ROWTYPE;
  v_years NUMBER;
  v_new_salary NUMBER;
BEGIN
  SELECT * INTO v_emp FROM Employee WHERE emp_id = 115;
  v_years := TRUNC(MONTHS_BETWEEN(SYSDATE, v_emp.DoJ)/12);
  IF v_years > 10 THEN
    v_new_salary := v_emp.salary * 1.20;
  ELSIF v_years > 5 THEN
    v_new_salary := v_emp.salary * 1.10;
  ELSE
    v_new_salary := v_emp.salary * 1.05;
  END IF;
  INSERT INTO Salary_Increment(emp_id, new_salary) VALUES(115, v_new_salary);
  COMMIT;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    DBMS_OUTPUT.PUT_LINE('Employee not found');
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('Error: '||SQLERRM);
END;
/
SELECT * FROM Salary_Increment;
